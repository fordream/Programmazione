/BreakIntoLines {		% stack: textstring linewidth proc => ...
	/proc exch def
	/linewidth exch def
	/textstring exch def

	/breakwidth wordbreak stringwidth pop def
	/curwidth 0 def
	/lastwordbreak 0 def
	/startchar 0 def
	/restoftext textstring def

	{ restoftext wordbreak search
		{
			/nextword exch def pop
			/restoftext exch def
			/wordwidth nextword stringwidth pop def
	
			curwidth wordwidth add linewidth gt
				{ textstring startchar
					lastwordbreak startchar sub
					getinterval proc
					/startchar lastwordbreak def
					/curwidth wordwidth breakwidth add def }
				{ /curwidth curwidth wordwidth add
					breakwidth add def }
				ifelse

			/lastwordbreak lastwordbreak
				nextword length add 1 add def
		}
		{ pop exit }
		ifelse
	} loop
	/lastchar textstring length def
	textstring startchar lastchar startchar sub
		getinterval proc
} def
